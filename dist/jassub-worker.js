"use strict";var Module=function(f){f=f||{};var f=f,h;f.ready=new Promise((t,r)=>{h=t});function v(t){console.log(t)}function y(t){console.error(t)}function F(){h(f)}function $(t,r){if(!t)throw r}let w=null;v=t=>{t==="JASSUB: No usable fontconfig configuration file found, using fallback."?console.debug(t):console.log(t)},y=t=>{t==="Fontconfig error: Cannot load default config file: No such file: (null)"?console.debug(t):console.error(t)};function R(t){throw t}var P=0,S=t=>{P=t},O=()=>P,j=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function k(t,r,n){for(var i=r+n,o=r;t[o]&&!(o>=i);)++o;if(o-r>16&&t.subarray&&j)return j.decode(t.subarray(r,o));for(var u="";r<o;){var p=t[r++];if(!(p&128)){u+=String.fromCharCode(p);continue}var l=t[r++]&63;if((p&224)==192){u+=String.fromCharCode((p&31)<<6|l);continue}var g=t[r++]&63;if((p&240)==224?p=(p&15)<<12|l<<6|g:p=(p&7)<<18|l<<12|g<<6|t[r++]&63,p<65536)u+=String.fromCharCode(p);else{var m=p-65536;u+=String.fromCharCode(55296|m>>10,56320|m&1023)}}return u}function H(t,r){return t?k(M,t,r):""}function Ae(t,r,n,i){if(!(i>0))return 0;for(var o=n,u=n+i-1,p=0;p<t.length;++p){var l=t.charCodeAt(p);if(l>=55296&&l<=57343){var g=t.charCodeAt(++p);l=65536+((l&1023)<<10)|g&1023}if(l<=127){if(n>=u)break;r[n++]=l}else if(l<=2047){if(n+1>=u)break;r[n++]=192|l>>6,r[n++]=128|l&63}else if(l<=65535){if(n+2>=u)break;r[n++]=224|l>>12,r[n++]=128|l>>6&63,r[n++]=128|l&63}else{if(n+3>=u)break;r[n++]=240|l>>18,r[n++]=128|l>>12&63,r[n++]=128|l>>6&63,r[n++]=128|l&63}}return r[n]=0,n-o}function Pe(t,r,n){return Ae(t,M,r,n)}function Fe(t){for(var r=0,n=0;n<t.length;++n){var i=t.charCodeAt(n);i>=55296&&i<=57343&&(i=65536+((i&1023)<<10)|t.charCodeAt(++n)&1023),i<=127?++r:i<=2047?r+=2:i<=65535?r+=3:r+=4}return r}var N,X,W,M,te,B,ge,he,x,ae,xe;function se(t){ae=t,N=new Int8Array(t),X=new Int16Array(t),W=new Int32Array(t),M=new Uint8Array(t),te=new Uint16Array(t),B=new Uint32Array(t),ge=new Float32Array(t),he=new Float64Array(t)}var ft=32768;if(x=new WebAssembly.Memory({initial:256,maximum:ft}),se(x.buffer),(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function(r,n){var i=r>>>16,o=r&65535,u=n>>>16,p=n&65535;return o*p+(i*p+o*u<<16)|0}),!Math.fround){var Ve=new Float32Array(1);Math.fround=function(t){return Ve[0]=t,Ve[0]}}Math.clz32||(Math.clz32=function(t){var r=32,n=t>>16;return n&&(r-=16,t=n),n=t>>8,n&&(r-=8,t=n),n=t>>4,n&&(r-=4,t=n),n=t>>2,n&&(r-=2,t=n),n=t>>1,n?r-2:r-t}),Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)});var me=[];function ve(t){var r=me[t];return r||(t>=me.length&&(me.length=t+1),me[t]=r=xe.get(t)),r}function ut(t,r,n,i){R("Assertion failed: "+H(t)+", at: "+[r?H(r):"unknown filename",n,i?H(i):"unknown function"])}var z={buffers:[null,[],[]],printChar:function(t,r){var n=z.buffers[t];r===0||r===10?((t===1?v:y)(k(n,0)),n.length=0):n.push(r)},varargs:void 0,get:function(){z.varargs+=4;var t=W[z.varargs-4>>2];return t},getStr:function(t){var r=H(t);return r},get64:function(t,r){return t}};function ct(t,r,n){return z.varargs=n,0}function dt(t,r,n){}function pt(t,r,n){return z.varargs=n,0}function gt(t,r,n){z.varargs=n}function ht(t,r,n,i,o){}function Se(t){switch(t){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+t)}}function mt(){for(var t=new Array(256),r=0;r<256;++r)t[r]=String.fromCharCode(r);Ge=t}var Ge=void 0;function I(t){for(var r="",n=t;M[n];)r+=Ge[M[n++]];return r}var re={},ne={},ye={},vt=48,yt=57;function je(t){if(t===void 0)return"_unknown";t=t.replace(/[^a-zA-Z0-9_]/g,"$");var r=t.charCodeAt(0);return r>=vt&&r<=yt?"_"+t:t}function $e(t,r){return t=je(t),new Function("body","return function "+t+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(r)}function Re(t,r){var n=$e(r,function(i){this.name=r,this.message=i;var o=new Error(i).stack;o!==void 0&&(this.stack=this.toString()+`
`+o.replace(/^Error(:[^\n]*)?\n/,""))});return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},n}var ie=void 0;function A(t){throw new ie(t)}var Je=void 0;function be(t){throw new Je(t)}function ee(t,r,n){t.forEach(function(l){ye[l]=r});function i(l){var g=n(l);g.length!==t.length&&be("Mismatched type converter count");for(var m=0;m<t.length;++m)q(t[m],g[m])}var o=new Array(r.length),u=[],p=0;r.forEach(function(l,g){ne.hasOwnProperty(l)?o[g]=ne[l]:(u.push(l),re.hasOwnProperty(l)||(re[l]=[]),re[l].push(function(){o[g]=ne[l],++p,p===u.length&&i(o)}))}),u.length===0&&i(o)}function q(t,r,n={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=r.name;if(t||A('type "'+i+'" must have a positive integer typeid pointer'),ne.hasOwnProperty(t)){if(n.ignoreDuplicateRegistrations)return;A("Cannot register type '"+i+"' twice")}if(ne[t]=r,delete ye[t],re.hasOwnProperty(t)){var o=re[t];delete re[t],o.forEach(function(u){u()})}}function bt(t,r,n,i,o){var u=Se(n);r=I(r),q(t,{name:r,fromWireType:function(p){return!!p},toWireType:function(p,l){return l?i:o},argPackAdvance:8,readValueFromPointer:function(p){var l;if(n===1)l=N;else if(n===2)l=X;else if(n===4)l=W;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(l[p>>u])},destructorFunction:null})}function wt(t){if(!(this instanceof Q)||!(t instanceof Q))return!1;for(var r=this.$$.ptrType.registeredClass,n=this.$$.ptr,i=t.$$.ptrType.registeredClass,o=t.$$.ptr;r.baseClass;)n=r.upcast(n),r=r.baseClass;for(;i.baseClass;)o=i.upcast(o),i=i.baseClass;return r===i&&n===o}function Ct(t){return{count:t.count,deleteScheduled:t.deleteScheduled,preservePointerOnDelete:t.preservePointerOnDelete,ptr:t.ptr,ptrType:t.ptrType,smartPtr:t.smartPtr,smartPtrType:t.smartPtrType}}function Oe(t){function r(n){return n.$$.ptrType.registeredClass.name}A(r(t)+" instance already deleted")}var Me=!1;function ze(t){}function _t(t){t.smartPtr?t.smartPtrType.rawDestructor(t.smartPtr):t.ptrType.registeredClass.rawDestructor(t.ptr)}function qe(t){t.count.value-=1;var r=t.count.value===0;r&&_t(t)}function Ke(t,r,n){if(r===n)return t;if(n.baseClass===void 0)return null;var i=Ke(t,r,n.baseClass);return i===null?null:n.downcast(i)}var Ye={};function Tt(){return Object.keys(fe).length}function At(){var t=[];for(var r in fe)fe.hasOwnProperty(r)&&t.push(fe[r]);return t}var oe=[];function Ee(){for(;oe.length;){var t=oe.pop();t.$$.deleteScheduled=!1,t.delete()}}var le=void 0;function Pt(t){le=t,oe.length&&le&&le(Ee)}function Ft(){f.getInheritedInstanceCount=Tt,f.getLiveInheritedInstances=At,f.flushPendingDeletes=Ee,f.setDelayFunction=Pt}var fe={};function St(t,r){for(r===void 0&&A("ptr should not be undefined");t.baseClass;)r=t.upcast(r),t=t.baseClass;return r}function jt(t,r){return r=St(t,r),fe[r]}function we(t,r){(!r.ptrType||!r.ptr)&&be("makeClassHandle requires ptr and ptrType");var n=!!r.smartPtrType,i=!!r.smartPtr;return n!==i&&be("Both smartPtrType and smartPtr must be specified"),r.count={value:1},ue(Object.create(t,{$$:{value:r}}))}function $t(t){var r=this.getPointee(t);if(!r)return this.destructor(t),null;var n=jt(this.registeredClass,r);if(n!==void 0){if(n.$$.count.value===0)return n.$$.ptr=r,n.$$.smartPtr=t,n.clone();var i=n.clone();return this.destructor(t),i}function o(){return this.isSmartPointer?we(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:r,smartPtrType:this,smartPtr:t}):we(this.registeredClass.instancePrototype,{ptrType:this,ptr:t})}var u=this.registeredClass.getActualType(r),p=Ye[u];if(!p)return o.call(this);var l;this.isConst?l=p.constPointerType:l=p.pointerType;var g=Ke(r,this.registeredClass,l.registeredClass);return g===null?o.call(this):this.isSmartPointer?we(l.registeredClass.instancePrototype,{ptrType:l,ptr:g,smartPtrType:this,smartPtr:t}):we(l.registeredClass.instancePrototype,{ptrType:l,ptr:g})}function ue(t){return typeof FinalizationRegistry>"u"?(ue=r=>r,t):(Me=new FinalizationRegistry(r=>{qe(r.$$)}),ue=r=>{var n=r.$$,i=!!n.smartPtr;if(i){var o={$$:n};Me.register(r,o,r)}return r},ze=r=>Me.unregister(r),ue(t))}function Rt(){if(this.$$.ptr||Oe(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var t=ue(Object.create(Object.getPrototypeOf(this),{$$:{value:Ct(this.$$)}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function Ot(){this.$$.ptr||Oe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&A("Object already scheduled for deletion"),ze(this),qe(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Mt(){return!this.$$.ptr}function Et(){return this.$$.ptr||Oe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&A("Object already scheduled for deletion"),oe.push(this),oe.length===1&&le&&le(Ee),this.$$.deleteScheduled=!0,this}function Wt(){Q.prototype.isAliasOf=wt,Q.prototype.clone=Rt,Q.prototype.delete=Ot,Q.prototype.isDeleted=Mt,Q.prototype.deleteLater=Et}function Q(){}function Xe(t,r,n){if(t[r].overloadTable===void 0){var i=t[r];t[r]=function(){return t[r].overloadTable.hasOwnProperty(arguments.length)||A("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+t[r].overloadTable+")!"),t[r].overloadTable[arguments.length].apply(this,arguments)},t[r].overloadTable=[],t[r].overloadTable[i.argCount]=i}}function kt(t,r,n){f.hasOwnProperty(t)?((n===void 0||f[t].overloadTable!==void 0&&f[t].overloadTable[n]!==void 0)&&A("Cannot register public name '"+t+"' twice"),Xe(f,t,t),f.hasOwnProperty(n)&&A("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),f[t].overloadTable[n]=r):(f[t]=r,n!==void 0&&(f[t].numArguments=n))}function Ut(t,r,n,i,o,u,p,l){this.name=t,this.constructor=r,this.instancePrototype=n,this.rawDestructor=i,this.baseClass=o,this.getActualType=u,this.upcast=p,this.downcast=l,this.pureVirtualFunctions=[]}function Ce(t,r,n){for(;r!==n;)r.upcast||A("Expected null or instance of "+n.name+", got an instance of "+r.name),t=r.upcast(t),r=r.baseClass;return t}function Dt(t,r){if(r===null)return this.isReference&&A("null is not a valid "+this.name),0;r.$$||A('Cannot pass "'+Ue(r)+'" as a '+this.name),r.$$.ptr||A("Cannot pass deleted object as a pointer of type "+this.name);var n=r.$$.ptrType.registeredClass,i=Ce(r.$$.ptr,n,this.registeredClass);return i}function It(t,r){var n;if(r===null)return this.isReference&&A("null is not a valid "+this.name),this.isSmartPointer?(n=this.rawConstructor(),t!==null&&t.push(this.rawDestructor,n),n):0;r.$$||A('Cannot pass "'+Ue(r)+'" as a '+this.name),r.$$.ptr||A("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&r.$$.ptrType.isConst&&A("Cannot convert argument of type "+(r.$$.smartPtrType?r.$$.smartPtrType.name:r.$$.ptrType.name)+" to parameter type "+this.name);var i=r.$$.ptrType.registeredClass;if(n=Ce(r.$$.ptr,i,this.registeredClass),this.isSmartPointer)switch(r.$$.smartPtr===void 0&&A("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:r.$$.smartPtrType===this?n=r.$$.smartPtr:A("Cannot convert argument of type "+(r.$$.smartPtrType?r.$$.smartPtrType.name:r.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:n=r.$$.smartPtr;break;case 2:if(r.$$.smartPtrType===this)n=r.$$.smartPtr;else{var o=r.clone();n=this.rawShare(n,ke.toHandle(function(){o.delete()})),t!==null&&t.push(this.rawDestructor,n)}break;default:A("Unsupporting sharing policy")}return n}function Lt(t,r){if(r===null)return this.isReference&&A("null is not a valid "+this.name),0;r.$$||A('Cannot pass "'+Ue(r)+'" as a '+this.name),r.$$.ptr||A("Cannot pass deleted object as a pointer of type "+this.name),r.$$.ptrType.isConst&&A("Cannot convert argument of type "+r.$$.ptrType.name+" to parameter type "+this.name);var n=r.$$.ptrType.registeredClass,i=Ce(r.$$.ptr,n,this.registeredClass);return i}function _e(t){return this.fromWireType(B[t>>2])}function Ht(t){return this.rawGetPointee&&(t=this.rawGetPointee(t)),t}function Bt(t){this.rawDestructor&&this.rawDestructor(t)}function xt(t){t!==null&&t.delete()}function Vt(){K.prototype.getPointee=Ht,K.prototype.destructor=Bt,K.prototype.argPackAdvance=8,K.prototype.readValueFromPointer=_e,K.prototype.deleteObject=xt,K.prototype.fromWireType=$t}function K(t,r,n,i,o,u,p,l,g,m,C){this.name=t,this.registeredClass=r,this.isReference=n,this.isConst=i,this.isSmartPointer=o,this.pointeeType=u,this.sharingPolicy=p,this.rawGetPointee=l,this.rawConstructor=g,this.rawShare=m,this.rawDestructor=C,!o&&r.baseClass===void 0?i?(this.toWireType=Dt,this.destructorFunction=null):(this.toWireType=Lt,this.destructorFunction=null):this.toWireType=It}function Gt(t,r,n){f.hasOwnProperty(t)||be("Replacing nonexistant public symbol"),f[t].overloadTable!==void 0&&n!==void 0?f[t].overloadTable[n]=r:(f[t]=r,f[t].argCount=n)}function Jt(t,r,n){var i=dynCalls[t];return n&&n.length?i.apply(null,[r].concat(n)):i.call(null,r)}function zt(t,r,n){return t.includes("j")?Jt(t,r,n):ve(r).apply(null,n)}function qt(t,r){var n=[];return function(){return n.length=0,Object.assign(n,arguments),zt(t,r,n)}}function Z(t,r){t=I(t);function n(){return t.includes("j")?qt(t,r):ve(r)}var i=n();return typeof i!="function"&&A("unknown function pointer with signature "+t+": "+r),i}var Qe=void 0;function Kt(t){var r=nt(t),n=I(r);return G(r),n}function ce(t,r){var n=[],i={};function o(u){if(!i[u]&&!ne[u]){if(ye[u]){ye[u].forEach(o);return}n.push(u),i[u]=!0}}throw r.forEach(o),new Qe(t+": "+n.map(Kt).join([", "]))}function Yt(t,r,n,i,o,u,p,l,g,m,C,_,T){C=I(C),u=Z(o,u),l&&(l=Z(p,l)),m&&(m=Z(g,m)),T=Z(_,T);var E=je(C);kt(E,function(){ce("Cannot construct "+C+" due to unbound types",[i])}),ee([t,r,n],i?[i]:[],function(U){U=U[0];var D,L;i?(D=U.registeredClass,L=D.instancePrototype):L=Q.prototype;var J=$e(E,function(){if(Object.getPrototypeOf(this)!==pe)throw new ie("Use 'new' to construct "+C);if(Y.constructor_body===void 0)throw new ie(C+" has no accessible constructor");var lt=Y.constructor_body[arguments.length];if(lt===void 0)throw new ie("Tried to invoke ctor of "+C+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Y.constructor_body).toString()+") parameters instead!");return lt.apply(this,arguments)}),pe=Object.create(L,{constructor:{value:J}});J.prototype=pe;var Y=new Ut(C,J,pe,T,D,u,l,m),Br=new K(C,Y,!0,!1,!1),st=new K(C+"*",Y,!1,!1,!1),ot=new K(C+" const*",Y,!1,!0,!1);return Ye[t]={pointerType:st,constPointerType:ot},Gt(E,J),[Br,st,ot]})}function Ze(t,r){for(var n=[],i=0;i<t;i++)n.push(W[(r>>2)+i]);return n}function Ne(t){for(;t.length;){var r=t.pop(),n=t.pop();n(r)}}function Xt(t,r,n,i,o,u){$(r>0);var p=Ze(r,n);o=Z(i,o),ee([],[t],function(l){l=l[0];var g="constructor "+l.name;if(l.registeredClass.constructor_body===void 0&&(l.registeredClass.constructor_body=[]),l.registeredClass.constructor_body[r-1]!==void 0)throw new ie("Cannot register multiple constructors with identical number of parameters ("+(r-1)+") for class '"+l.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return l.registeredClass.constructor_body[r-1]=()=>{ce("Cannot construct "+l.name+" due to unbound types",p)},ee([],p,function(m){return m.splice(1,0,null),l.registeredClass.constructor_body[r-1]=et(g,m,null,o,u),[]}),[]})}function Qt(t,r){if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+typeof t+" which is not a function");var n=$e(t.name||"unknownFunctionName",function(){});n.prototype=t.prototype;var i=new n,o=t.apply(i,r);return o instanceof Object?o:i}function et(t,r,n,i,o){var u=r.length;u<2&&A("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var p=r[1]!==null&&n!==null,l=!1,g=1;g<r.length;++g)if(r[g]!==null&&r[g].destructorFunction===void 0){l=!0;break}for(var m=r[0].name!=="void",C="",_="",g=0;g<u-2;++g)C+=(g!==0?", ":"")+"arg"+g,_+=(g!==0?", ":"")+"arg"+g+"Wired";var T="return function "+je(t)+"("+C+`) {
if (arguments.length !== `+(u-2)+`) {
throwBindingError('function `+t+" called with ' + arguments.length + ' arguments, expected "+(u-2)+` args!');
}
`;l&&(T+=`var destructors = [];
`);var E=l?"destructors":"null",U=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],D=[A,i,o,Ne,r[0],r[1]];p&&(T+="var thisWired = classParam.toWireType("+E+`, this);
`);for(var g=0;g<u-2;++g)T+="var arg"+g+"Wired = argType"+g+".toWireType("+E+", arg"+g+"); // "+r[g+2].name+`
`,U.push("argType"+g),D.push(r[g+2]);if(p&&(_="thisWired"+(_.length>0?", ":"")+_),T+=(m?"var rv = ":"")+"invoker(fn"+(_.length>0?", ":"")+_+`);
`,l)T+=`runDestructors(destructors);
`;else for(var g=p?1:2;g<r.length;++g){var L=g===1?"thisWired":"arg"+(g-2)+"Wired";r[g].destructorFunction!==null&&(T+=L+"_dtor("+L+"); // "+r[g].name+`
`,U.push(L+"_dtor"),D.push(r[g].destructorFunction))}m&&(T+=`var ret = retType.fromWireType(rv);
return ret;
`),T+=`}
`,U.push(T);var J=Qt(Function,U).apply(null,D);return J}function Zt(t,r,n,i,o,u,p,l){var g=Ze(n,i);r=I(r),u=Z(o,u),ee([],[t],function(m){m=m[0];var C=m.name+"."+r;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),l&&m.registeredClass.pureVirtualFunctions.push(r);function _(){ce("Cannot call "+C+" due to unbound types",g)}var T=m.registeredClass.instancePrototype,E=T[r];return E===void 0||E.overloadTable===void 0&&E.className!==m.name&&E.argCount===n-2?(_.argCount=n-2,_.className=m.name,T[r]=_):(Xe(T,r,C),T[r].overloadTable[n-2]=_),ee([],g,function(U){var D=et(C,U,m,u,p);return T[r].overloadTable===void 0?(D.argCount=n-2,T[r]=D):T[r].overloadTable[n-2]=D,[]}),[]})}function tt(t,r,n){return t instanceof Object||A(n+' with invalid "this": '+t),t instanceof r.registeredClass.constructor||A(n+' incompatible with "this" of type '+t.constructor.name),t.$$.ptr||A("cannot call emscripten binding method "+n+" on deleted object"),Ce(t.$$.ptr,t.$$.ptrType.registeredClass,r.registeredClass)}function Nt(t,r,n,i,o,u,p,l,g,m){r=I(r),o=Z(i,o),ee([],[t],function(C){C=C[0];var _=C.name+"."+r,T={get:function(){ce("Cannot access "+_+" due to unbound types",[n,p])},enumerable:!0,configurable:!0};return g?T.set=()=>{ce("Cannot access "+_+" due to unbound types",[n,p])}:T.set=E=>{A(_+" is a read-only property")},Object.defineProperty(C.registeredClass.instancePrototype,r,T),ee([],g?[n,p]:[n],function(E){var U=E[0],D={get:function(){var J=tt(this,C,_+" getter");return U.fromWireType(o(u,J))},enumerable:!0};if(g){g=Z(l,g);var L=E[1];D.set=function(J){var pe=tt(this,C,_+" setter"),Y=[];g(m,pe,L.toWireType(Y,J)),Ne(Y)}}return Object.defineProperty(C.registeredClass.instancePrototype,r,D),[]}),[]})}var We=[],V=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function er(t){t>4&&--V[t].refcount===0&&(V[t]=void 0,We.push(t))}function tr(){for(var t=0,r=5;r<V.length;++r)V[r]!==void 0&&++t;return t}function rr(){for(var t=5;t<V.length;++t)if(V[t]!==void 0)return V[t];return null}function nr(){f.count_emval_handles=tr,f.get_first_emval=rr}var ke={toValue:function(t){return t||A("Cannot use deleted val. handle = "+t),V[t].value},toHandle:function(t){switch(t){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var r=We.length?We.pop():V.length;return V[r]={refcount:1,value:t},r}}}};function ir(t,r){r=I(r),q(t,{name:r,fromWireType:function(n){var i=ke.toValue(n);return er(n),i},toWireType:function(n,i){return ke.toHandle(i)},argPackAdvance:8,readValueFromPointer:_e,destructorFunction:null})}function Ue(t){if(t===null)return"null";var r=typeof t;return r==="object"||r==="array"||r==="function"?t.toString():""+t}function ar(t,r){switch(r){case 2:return function(n){return this.fromWireType(ge[n>>2])};case 3:return function(n){return this.fromWireType(he[n>>3])};default:throw new TypeError("Unknown float type: "+t)}}function sr(t,r,n){var i=Se(n);r=I(r),q(t,{name:r,fromWireType:function(o){return o},toWireType:function(o,u){return u},argPackAdvance:8,readValueFromPointer:ar(r,i),destructorFunction:null})}function or(t,r,n){switch(r){case 0:return n?function(o){return N[o]}:function(o){return M[o]};case 1:return n?function(o){return X[o>>1]}:function(o){return te[o>>1]};case 2:return n?function(o){return W[o>>2]}:function(o){return B[o>>2]};default:throw new TypeError("Unknown integer type: "+t)}}function lr(t,r,n,i,o){r=I(r);var u=Se(n),p=_=>_;if(i===0){var l=32-8*n;p=_=>_<<l>>>l}var g=r.includes("unsigned"),m=(_,T)=>{},C;g?C=function(_,T){return m(T,this.name),T>>>0}:C=function(_,T){return m(T,this.name),T},q(t,{name:r,fromWireType:p,toWireType:C,argPackAdvance:8,readValueFromPointer:or(r,u,i!==0),destructorFunction:null})}function fr(t,r,n){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],o=i[r];function u(p){p=p>>2;var l=B,g=l[p],m=l[p+1];return new o(ae,m,g)}n=I(n),q(t,{name:n,fromWireType:u,argPackAdvance:8,readValueFromPointer:u},{ignoreDuplicateRegistrations:!0})}function ur(t,r){r=I(r);var n=r==="std::string";q(t,{name:r,fromWireType:function(i){var o=B[i>>2],u;if(n)for(var p=i+4,l=0;l<=o;++l){var g=i+4+l;if(l==o||M[g]==0){var m=g-p,C=H(p,m);u===void 0?u=C:(u+=String.fromCharCode(0),u+=C),p=g+1}}else{for(var _=new Array(o),l=0;l<o;++l)_[l]=String.fromCharCode(M[i+4+l]);u=_.join("")}return G(i),u},toWireType:function(i,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var u,p=typeof o=="string";p||o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||A("Cannot pass non-string to std::string"),n&&p?u=()=>Fe(o):u=()=>o.length;var l=u(),g=Te(4+l+1);if(B[g>>2]=l,n&&p)Pe(o,g+4,l+1);else if(p)for(var m=0;m<l;++m){var C=o.charCodeAt(m);C>255&&(G(g),A("String has UTF-16 code units that do not fit in 8 bits")),M[g+4+m]=C}else for(var m=0;m<l;++m)M[g+4+m]=o[m];return i!==null&&i.push(G,g),g},argPackAdvance:8,readValueFromPointer:_e,destructorFunction:function(i){G(i)}})}function cr(t,r){for(var n=t,i=n>>1,o=i+r/2;!(i>=o)&&te[i];)++i;if(n=i<<1,n-t>32&&UTF16Decoder)return UTF16Decoder.decode(M.subarray(t,n));for(var u="",p=0;!(p>=r/2);++p){var l=X[t+p*2>>1];if(l==0)break;u+=String.fromCharCode(l)}return u}function dr(t,r,n){if(n===void 0&&(n=2147483647),n<2)return 0;n-=2;for(var i=r,o=n<t.length*2?n/2:t.length,u=0;u<o;++u){var p=t.charCodeAt(u);X[r>>1]=p,r+=2}return X[r>>1]=0,r-i}function pr(t){return t.length*2}function gr(t,r){for(var n=0,i="";!(n>=r/4);){var o=W[t+n*4>>2];if(o==0)break;if(++n,o>=65536){var u=o-65536;i+=String.fromCharCode(55296|u>>10,56320|u&1023)}else i+=String.fromCharCode(o)}return i}function hr(t,r,n){if(n===void 0&&(n=2147483647),n<4)return 0;for(var i=r,o=i+n-4,u=0;u<t.length;++u){var p=t.charCodeAt(u);if(p>=55296&&p<=57343){var l=t.charCodeAt(++u);p=65536+((p&1023)<<10)|l&1023}if(W[r>>2]=p,r+=4,r+4>o)break}return W[r>>2]=0,r-i}function mr(t){for(var r=0,n=0;n<t.length;++n){var i=t.charCodeAt(n);i>=55296&&i<=57343&&++n,r+=4}return r}function vr(t,r,n){n=I(n);var i,o,u,p,l;r===2?(i=cr,o=dr,p=pr,u=()=>te,l=1):r===4&&(i=gr,o=hr,p=mr,u=()=>B,l=2),q(t,{name:n,fromWireType:function(g){for(var m=B[g>>2],C=u(),_,T=g+4,E=0;E<=m;++E){var U=g+4+E*r;if(E==m||C[U>>l]==0){var D=U-T,L=i(T,D);_===void 0?_=L:(_+=String.fromCharCode(0),_+=L),T=U+r}}return G(g),_},toWireType:function(g,m){typeof m!="string"&&A("Cannot pass non-string to C++ string type "+n);var C=p(m),_=Te(4+C+r);return B[_>>2]=C>>l,o(m,_+4,C+r),g!==null&&g.push(G,_),_},argPackAdvance:8,readValueFromPointer:_e,destructorFunction:function(g){G(g)}})}function yr(t,r){r=I(r),q(t,{isVoid:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(n,i){}})}function br(){throw 1/0}function wr(){R("")}var De;typeof performance<"u"&&performance.now?De=()=>performance.now():De=Date.now;var Cr=Uint8Array.prototype.copyWithin?function(t,r,n){M.copyWithin(t,r,r+n)}:function(t,r,n){M.set(M.subarray(r,r+n),t)};function _r(){return 2147483648}function Tr(t){try{return x.grow(t-ae.byteLength+65535>>>16),se(x.buffer),1}catch{}}function Ar(t){var r=M.length;t=t>>>0;var n=_r();if(t>n)return!1;let i=(g,m)=>g+(m-g%m)%m;for(var o=1;o<=4;o*=2){var u=r*(1+.2/o);u=Math.min(u,t+100663296);var p=Math.min(n,i(Math.max(t,u),65536)),l=Tr(p);if(l)return!0}return!1}var Ie={};function Pr(){return"./this.program"}function de(){if(!de.strings){var t=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:t,_:Pr()};for(var n in Ie)Ie[n]===void 0?delete r[n]:r[n]=Ie[n];var i=[];for(var n in r)i.push(n+"="+r[n]);de.strings=i}return de.strings}function Fr(t,r,n){for(var i=0;i<t.length;++i)N[r++>>0]=t.charCodeAt(i);n||(N[r>>0]=0)}function Sr(t,r){var n=0;return de().forEach(function(i,o){var u=r+n;W[t+o*4>>2]=u,Fr(i,u),n+=i.length+1}),0}function jr(t,r){var n=de();W[t>>2]=n.length;var i=0;return n.forEach(function(o){i+=o.length+1}),W[r>>2]=i,0}function $r(t){throw"exit("+t+")"}function Rr(t){return $r(t)}function Or(t){return 0}function Mr(t,r,n,i){var o=z.getStreamFromFD(t),u=z.doReadv(o,r,n);return W[i>>2]=u,0}function Er(t,r,n,i,o){}function Wr(t,r,n,i){for(var o=0,u=0;u<n;u++){var p=W[r>>2],l=W[r+4>>2];r+=8;for(var g=0;g<l;g++)z.printChar(t,M[p+g]);o+=l}return W[i>>2]=o,0}function kr(){return O()}function Ur(t){S(t)}mt(),ie=f.BindingError=Re(Error,"BindingError"),Je=f.InternalError=Re(Error,"InternalError"),Wt(),Ft(),Vt(),Qe=f.UnboundTypeError=Re(Error,"UnboundTypeError"),nr();var Dr={b:ut,p:ct,B:dt,H:pt,q:gt,x:ht,t:bt,i:Yt,v:Xt,d:Zt,c:Nt,I:ir,r:sr,g:lr,e:fr,s:ur,m:vr,u:yr,A:br,f:wr,o:De,E:Cr,l:Ar,C:Sr,D:jr,n:Rr,j:Or,G:Mr,w:Er,F:Wr,k:kr,z:Ir,y:Lr,a:x,h:Ur};function Ir(t,r,n){var i=He();try{return ve(t)(r,n)}catch(o){if(Be(i),o!==o+0)throw o;Le(1,0)}}function Lr(t,r,n,i,o){var u=He();try{return ve(t)(r,n,i,o)}catch(p){if(Be(u),p!==p+0)throw p;Le(1,0)}}f.getTempRet0=O,f.setTempRet0=S;function Hr(t){t.J()}var rt={a:Dr},G,Te,nt,Le,He,Be;(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch("jassub-worker-modern.wasm"),rt):WebAssembly.instantiate(f.wasm,rt)).then(function(t){w=(t.instance||t).exports,G=w.K,Te=w.L,nt=w.M,w.N,Le=w.P,w.Q,He=w.R,Be=w.S,w.T,w.U,w.V,w.W,xe=w.O,Hr(w),F()});const it=()=>{try{typeof x<"u"&&(self.wasmMemory=x,self.HEAPU8C=new Uint8ClampedArray(x.buffer)),typeof M<"u"&&(self.HEAPU8=M)}catch{}};if(typeof se=="function"){const t=se;se=r=>{t(r),it()}}const at=typeof F=="function"?F:null;return at&&(F=()=>(f._malloc=Te,f._free=G,it(),at())),f.ready};String.prototype.startsWith||(String.prototype.startsWith=function(s,f=0){return this.substring(f,s.length)===s});String.prototype.includes||(String.prototype.includes=function(s,f){return this.indexOf(s,f)!==-1});Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(s,f){return new Uint8Array(this.subarray(s,f))});function toAbsoluteIndex(s,f){const h=s>>0;return h<0?Math.max(h+f,0):Math.min(h,f)}Uint8Array.prototype.fill||(Int8Array.prototype.fill=Int16Array.prototype.fill=Int32Array.prototype.fill=Uint8Array.prototype.fill=Uint16Array.prototype.fill=Uint32Array.prototype.fill=Float32Array.prototype.fill=Float64Array.prototype.fill=Array.prototype.fill=function(s){if(this==null)throw new TypeError("this is null or not defined");const f=Object(this),h=f.length>>>0,v=arguments.length;let y=toAbsoluteIndex(v>1?arguments[1]:void 0,h);const F=v>2?arguments[2]:void 0,$=F===void 0?h:toAbsoluteIndex(F,h);for(;$>y;)f[y++]=s;return f});Uint8Array.prototype.copyWithin||(Int8Array.prototype.copyWithin=Int16Array.prototype.copyWithin=Int32Array.prototype.copyWithin=Uint8Array.prototype.copyWithin=Uint16Array.prototype.copyWithin=Uint32Array.prototype.copyWithin=Float32Array.prototype.copyWithin=Float64Array.prototype.copyWithin=Array.prototype.copyWithin=function(s,f){const h=Object(this),v=h.length>>>0;let y=toAbsoluteIndex(s,v),F=toAbsoluteIndex(f,v);const $=arguments.length>2?arguments[2]:void 0;let w=Math.min(($===void 0?v:toAbsoluteIndex($,v))-F,v-y),R=1;for(F<y&&y<F+w&&(R=-1,F+=w-1,y+=w-1);w-- >0;)F in h?h[y]=h[F]:delete h[y],y+=R,F+=R;return h});Date.now||(Date.now=()=>new Date().getTime());"performance"in self||(self.performance={now:()=>Date.now()});if(typeof console>"u"){const s=(f,h)=>{postMessage({target:"console",command:f,content:JSON.stringify(Array.prototype.slice.call(h))})};self.console={log:function(){s("log",arguments)},debug:function(){s("debug",arguments)},info:function(){s("info",arguments)},warn:function(){s("warn",arguments)},error:function(){s("error",arguments)}},console.log("Detected lack of console, overridden console")}let promiseSupported=typeof Promise<"u";if(promiseSupported)try{let s;new Promise(f=>{s=f}),s()}catch{promiseSupported=!1}promiseSupported||(self.Promise=function(s){let f=()=>{};return s(h=>setTimeout(()=>f(h),0)),{then:h=>f=h}});const read_=(s,f)=>{const h=new XMLHttpRequest;return h.open("GET",s,!1),h.responseType=f?"arraybuffer":"text",h.send(null),h.response},readAsync=(s,f,h)=>{const v=new XMLHttpRequest;v.open("GET",s,!0),v.responseType="arraybuffer",v.onload=()=>{if((v.status===200||v.status===0)&&v.response)return f(v.response)},v.onerror=h,v.send(null)};let lastCurrentTime=0;const rate=1;let rafId=null,nextIsRaf=!1,lastCurrentTimeReceivedAt=Date.now(),targetFps=24,useLocalFonts=!1,blendMode="js",availableFonts={};const fontMap_={};let fontId=0,debug;self.width=0;self.height=0;const metrics={framesRendered:0,framesDropped:0,totalRenderTime:0,maxRenderTime:0,minRenderTime:1/0,lastRenderTime:0,renderStartTime:0,pendingRenders:0,totalEvents:0,currentEventIndex:0,cacheHits:0,cacheMisses:0},resetMetrics=()=>{metrics.framesRendered=0,metrics.framesDropped=0,metrics.totalRenderTime=0,metrics.maxRenderTime=0,metrics.minRenderTime=1/0,metrics.lastRenderTime=0,metrics.cacheHits=0,metrics.cacheMisses=0};let asyncRender=!1;self.addFont=({font:s})=>asyncWrite(s);const findAvailableFonts=s=>{s=s.trim().toLowerCase(),s.startsWith("@")&&(s=s.substring(1)),!fontMap_[s]&&(fontMap_[s]=!0,availableFonts[s]?asyncWrite(availableFonts[s]):useLocalFonts&&postMessage({target:"getLocalFont",font:s}))},asyncWrite=s=>{typeof s=="string"?readAsync(s,f=>{allocFont(new Uint8Array(f))},console.error):allocFont(s)};let pendingFontReload=null;const scheduleReloadFonts=()=>{pendingFontReload||(pendingFontReload=setTimeout(()=>{pendingFontReload=null,jassubObj&&jassubObj.reloadFonts()},16))},allocFont=s=>{const f=_malloc(s.byteLength);self.HEAPU8.set(s,f),jassubObj.addFont("font-"+fontId++,f,s.byteLength),scheduleReloadFonts()},processAvailableFonts=s=>{if(!availableFonts)return;const f=parseAss(s,!0);for(let v=0;v<f.length;v++)for(let y=0;y<f[v].body.length;y++)f[v].body[y].key==="Style"&&findAvailableFonts(f[v].body[y].value.Fontname);const h=s.match(/\[Events\][\s\S]*/i);if(h){const y=h[0].matchAll(/\\fn([^\\}]*?)[\\}]/g);for(const F of y)findAvailableFonts(F[1])}};self.setTrack=({content:s})=>{processAvailableFonts(s),dropAllBlur&&(s=dropBlur(s)),jassubObj.createTrackMem(s),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],postMessage({target:"verifyColorSpace",subtitleColorSpace})};self.getColorSpace=()=>postMessage({target:"verifyColorSpace",subtitleColorSpace});self.freeTrack=()=>{jassubObj.removeTrack()};self.setTrackByUrl=({url:s})=>{self.setTrack({content:read_(s)})};const getCurrentTime=()=>{const s=(Date.now()-lastCurrentTimeReceivedAt)/1e3;return _isPaused?lastCurrentTime:(s>5&&(console.error("Didn't received currentTime > 5 seconds. Assuming video was paused."),setIsPaused(!0)),lastCurrentTime+s*rate)},setCurrentTime=s=>{lastCurrentTime=s,lastCurrentTimeReceivedAt=Date.now(),rafId||(nextIsRaf?rafId=requestAnimationFrame(renderLoop):(renderLoop(),setTimeout(()=>{nextIsRaf=!1},20)))};let _isPaused=!0;const setIsPaused=s=>{s!==_isPaused&&(_isPaused=s,s?rafId&&(clearTimeout(rafId),rafId=null):(lastCurrentTimeReceivedAt=Date.now(),rafId=requestAnimationFrame(renderLoop)))},a="BT601",b="BT709",c="SMPTE240M",d="FCC",libassYCbCrMap=[null,a,null,a,a,b,b,c,c,d,d],render=(s,f)=>{const h={},v=performance.now();metrics.renderStartTime=v,metrics.pendingRenders++;const y=blendMode==="wasm"?jassubObj.renderBlend(s,f||0):jassubObj.renderImage(s,f||0),$=performance.now()-v;if(metrics.lastRenderTime=$,metrics.totalRenderTime+=$,metrics.maxRenderTime=Math.max(metrics.maxRenderTime,$),$>0&&(metrics.minRenderTime=Math.min(metrics.minRenderTime,$)),jassubObj.changed!==0||f?(metrics.framesRendered++,metrics.cacheMisses++):metrics.cacheHits++,jassubObj&&jassubObj.getEventCount&&(metrics.totalEvents=jassubObj.getEventCount()),debug){const w=performance.now(),R=jassubObj.time;h.WASMRenderTime=R-v,h.WASMBitmapDecodeTime=w-R,h.JSRenderTime=Date.now()}if(jassubObj.changed!==0||f){const w=[],R=[];if(!y)return paintImages({images:w,buffers:R,times:h});if(asyncRender){const P=[];for(let S=y,O=0;O<jassubObj.count;S=S.next,++O){const j={w:S.w,h:S.h,x:S.x,y:S.y},k=S.image,H=hasBitmapBug?self.HEAPU8C.slice(k,k+j.w*j.h*4):self.HEAPU8C.subarray(k,k+j.w*j.h*4);P.push(createImageBitmap(new ImageData(H,j.w,j.h))),w.push(j)}Promise.all(P).then(S=>{for(let O=0;O<w.length;O++)w[O].image=S[O];debug&&(h.JSBitmapGenerationTime=Date.now()-h.JSRenderTime),paintImages({images:w,buffers:S,times:h})})}else{for(let P=y,S=0;S<jassubObj.count;P=P.next,++S){const O={w:P.w,h:P.h,x:P.x,y:P.y,image:P.image};if(!offCanvasCtx){const j=self.wasmMemory.buffer.slice(P.image,P.image+P.w*P.h*4);R.push(j),O.image=j}w.push(O)}paintImages({images:w,buffers:R,times:h})}}else postMessage({target:"unbusy"})};self.demand=({time:s})=>{lastCurrentTime=s,render(s)};const renderLoop=s=>{rafId=0,render(getCurrentTime(),s),_isPaused||(rafId=requestAnimationFrame(renderLoop))},paintImages=({times:s,images:f,buffers:h})=>{metrics.pendingRenders--;const v={target:"render",asyncRender,images:f,times:s,width:self.width,height:self.height,colorSpace:subtitleColorSpace};if(offscreenRender){(offCanvas.height!==self.height||offCanvas.width!==self.width)&&(offCanvas.width=self.width,offCanvas.height=self.height),offCanvasCtx.clearRect(0,0,self.width,self.height);for(const y of f)y.image&&(asyncRender?(offCanvasCtx.drawImage(y.image,y.x,y.y),y.image.close()):(bufferCanvas.width=y.w,bufferCanvas.height=y.h,bufferCtx.putImageData(new ImageData(self.HEAPU8C.subarray(y.image,y.image+y.w*y.h*4),y.w,y.h),0,0),offCanvasCtx.drawImage(bufferCanvas,y.x,y.y)));if(offscreenRender==="hybrid"){if(!f.length)return postMessage(v);debug&&(s.bitmaps=f.length);try{const y=offCanvas.transferToImageBitmap();v.images=[{image:y,x:0,y:0}],v.asyncRender=!0,postMessage(v,[y])}catch{postMessage({target:"unbusy"})}}else{if(debug){s.JSRenderTime=Date.now()-s.JSRenderTime-(s.JSBitmapGenerationTime||0);let y=0;for(const F in s)y+=s[F];console.log("Bitmaps: "+f.length+" Total: "+(y|0)+"ms",s)}postMessage({target:"unbusy"})}}else postMessage(v,h)},parseAss=(s,f=!1)=>{let h,v,y,F,$,w,R,P,S,O;const j=[],k=s.split(/[\r\n]+/g);for(P=0;P<k.length;P++)if(h=k[P].match(/^\[(.*)\]$/),h){if(f&&h[1].toLowerCase()==="events")break;v=null,j.push({name:h[1],body:[]})}else{if(/^\s*$/.test(k[P])||j.length===0)continue;if(O=j[j.length-1].body,k[P][0]===";")O.push({type:"comment",value:k[P].substring(1)});else{if(F=k[P].split(":"),$=F[0],w=F.slice(1).join(":").trim(),(v||$==="Format")&&(w=w.split(","),v&&w.length>v.length&&(y=w.slice(v.length-1).join(","),w=w.slice(0,v.length-1),w.push(y)),w=w.map(H=>H.trim()),v)){for(R={},S=0;S<w.length;S++)R[v[S]]=w[S];w=R}$==="Format"&&(v=w),O.push({key:$,value:w})}}return j},blurRegex=/\\blur(?:[0-9]+\.)?[0-9]+/gm,dropBlur=s=>s.replace(blurRegex,""),requestAnimationFrame=(()=>{let s=0;return f=>{const h=Date.now();if(s===0)s=h+1e3/targetFps;else for(;h+2>=s;)s+=1e3/targetFps;const v=Math.max(s-h,0);return setTimeout(f,v)}})(),_applyKeys=(s,f)=>{for(const h of Object.keys(s))f[h]=s[h]};let offCanvas,offCanvasCtx,offscreenRender,bufferCanvas,bufferCtx,jassubObj,subtitleColorSpace,dropAllBlur,_malloc,hasBitmapBug;self.init=data=>{hasBitmapBug=data.hasBitmapBug;try{const s=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(!(s instanceof WebAssembly.Module)||!(new WebAssembly.Instance(s)instanceof WebAssembly.Instance))throw new Error("WASM not supported")}catch(e){console.warn(e),eval(read_(data.legacyWasmUrl))}const _fetch=self.fetch,setWasmUrl=s=>{WebAssembly.instantiateStreaming&&(self.fetch=f=>_fetch(s))},loadWasm=s=>(setWasmUrl(s),Module({wasm:!WebAssembly.instantiateStreaming&&read_(s,!0)})),onWasmLoaded=s=>{_malloc=s._malloc,self.width=data.width,self.height=data.height,blendMode=data.blendMode,asyncRender=data.asyncRender,asyncRender&&typeof createImageBitmap>"u"&&(asyncRender=!1,console.error("'createImageBitmap' needed for 'asyncRender' unsupported!")),availableFonts=data.availableFonts,debug=data.debug,targetFps=data.targetFps||targetFps,useLocalFonts=data.useLocalFonts,dropAllBlur=data.dropAllBlur;const f=data.fallbackFont.toLowerCase();jassubObj=new s.JASSUB(self.width,self.height,f||null,debug),f&&findAvailableFonts(f);let h=data.subContent;h||(h=read_(data.subUrl)),processAvailableFonts(h),dropAllBlur&&(h=dropBlur(h));for(const v of data.fonts||[])asyncWrite(v);jassubObj.createTrackMem(h),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],jassubObj.setDropAnimations(data.dropAllAnimations||0),(data.libassMemoryLimit>0||data.libassGlyphLimit>0)&&jassubObj.setMemoryLimits(data.libassGlyphLimit||0,data.libassMemoryLimit||0),postMessage({target:"ready"}),postMessage({target:"verifyColorSpace",subtitleColorSpace})};loadWasm(data.wasmUrl).then(onWasmLoaded).catch(s=>{if(data.fallbackWasmUrl&&data.fallbackWasmUrl!==data.wasmUrl)return console.warn("Failed to load selected WASM, falling back",s),loadWasm(data.fallbackWasmUrl).then(onWasmLoaded);throw s})};self.offscreenCanvas=({transferable:s})=>{offCanvas=s[0],offCanvasCtx=offCanvas.getContext("2d"),asyncRender||(bufferCanvas=new OffscreenCanvas(self.height,self.width),bufferCtx=bufferCanvas.getContext("2d",{desynchronized:!0})),offscreenRender=!0};self.detachOffscreen=()=>{offCanvas=new OffscreenCanvas(self.height,self.width),offCanvasCtx=offCanvas.getContext("2d",{desynchronized:!0}),offscreenRender="hybrid"};self.canvas=({width:s,height:f,videoWidth:h,videoHeight:v,force:y})=>{if(s==null)throw new Error("Invalid canvas size specified");self.width=s,self.height=f,jassubObj&&jassubObj.resizeCanvas(s,f,h,v),y&&render(lastCurrentTime,!0)};self.video=({currentTime:s,isPaused:f,rate:h})=>{s!=null&&setCurrentTime(s),f!=null&&setIsPaused(f),h=h||h};self.destroy=()=>{jassubObj.quitLibrary()};self.createEvent=({event:s})=>{_applyKeys(s,jassubObj.getEvent(jassubObj.allocEvent()))};self.getEvents=()=>{const s=[];for(let f=0;f<jassubObj.getEventCount();f++){const{Start:h,Duration:v,ReadOrder:y,Layer:F,Style:$,MarginL:w,MarginR:R,MarginV:P,Name:S,Text:O,Effect:j}=jassubObj.getEvent(f);s.push({Start:h,Duration:v,ReadOrder:y,Layer:F,Style:$,MarginL:w,MarginR:R,MarginV:P,Name:S,Text:O,Effect:j})}postMessage({target:"getEvents",events:s})};self.setEvent=({event:s,index:f})=>{_applyKeys(s,jassubObj.getEvent(f))};self.removeEvent=({index:s})=>{jassubObj.removeEvent(s)};self.createStyle=({style:s})=>{const f=jassubObj.getStyle(jassubObj.allocStyle());return _applyKeys(s,f),f};self.getStyles=()=>{const s=[];for(let f=0;f<jassubObj.getStyleCount();f++){const{Name:h,FontName:v,FontSize:y,PrimaryColour:F,SecondaryColour:$,OutlineColour:w,BackColour:R,Bold:P,Italic:S,Underline:O,StrikeOut:j,ScaleX:k,ScaleY:H,Spacing:Ae,Angle:Pe,BorderStyle:Fe,Outline:N,Shadow:X,Alignment:W,MarginL:M,MarginR:te,MarginV:B,Encoding:ge,treat_fontname_as_pattern:he,Blur:x,Justify:ae}=jassubObj.getStyle(f);s.push({Name:h,FontName:v,FontSize:y,PrimaryColour:F,SecondaryColour:$,OutlineColour:w,BackColour:R,Bold:P,Italic:S,Underline:O,StrikeOut:j,ScaleX:k,ScaleY:H,Spacing:Ae,Angle:Pe,BorderStyle:Fe,Outline:N,Shadow:X,Alignment:W,MarginL:M,MarginR:te,MarginV:B,Encoding:ge,treat_fontname_as_pattern:he,Blur:x,Justify:ae})}postMessage({target:"getStyles",time:Date.now(),styles:s})};self.setStyle=({style:s,index:f})=>{_applyKeys(s,jassubObj.getStyle(f))};self.removeStyle=({index:s})=>{jassubObj.removeStyle(s)};self.styleOverride=s=>{jassubObj.styleOverride(self.createStyle(s))};self.disableStyleOverride=()=>{jassubObj.disableStyleOverride()};self.defaultFont=({font:s})=>{jassubObj.setDefaultFont(s)};self.getStats=()=>{const s=metrics.framesRendered>0?metrics.totalRenderTime/metrics.framesRendered:0;postMessage({target:"getStats",stats:{framesRendered:metrics.framesRendered,framesDropped:metrics.framesDropped,avgRenderTime:Math.round(s*100)/100,maxRenderTime:Math.round(metrics.maxRenderTime*100)/100,minRenderTime:metrics.minRenderTime===1/0?0:Math.round(metrics.minRenderTime*100)/100,lastRenderTime:Math.round(metrics.lastRenderTime*100)/100,pendingRenders:Math.max(0,metrics.pendingRenders),totalEvents:metrics.totalEvents,cacheHits:metrics.cacheHits,cacheMisses:metrics.cacheMisses}})};self.resetStats=()=>{resetMetrics(),postMessage({target:"resetStats",success:!0})};onmessage=({data:s})=>{if(self[s.target])self[s.target](s);else throw new Error("Unknown event target "+s.target)};
